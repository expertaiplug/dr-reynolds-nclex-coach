<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Reynolds NCLEX Mastery Coach</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --surface: #ffffff;
            --surface-2: #f8fafc;
            --surface-3: #f1f5f9;
            --border: #e2e8f0;
            --text: #0f172a;
            --text-muted: #64748b;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-surface: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--gradient-surface);
            min-height: 100vh;
            color: var(--text);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1200px;
            margin: 0 auto;
            background: var(--surface);
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        /* Header */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="1" fill="white" opacity="0.1"/><circle cx="80" cy="40" r="0.5" fill="white" opacity="0.1"/><circle cx="40" cy="80" r="1.5" fill="white" opacity="0.1"/></svg>');
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(1deg); }
        }

        .header-content {
            position: relative;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .dr-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            border: 4px solid rgba(255, 255, 255, 0.3);
            position: relative;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .dr-avatar::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), transparent);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.05); }
        }

        .header-text h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header-text .subtitle {
            font-size: 1.125rem;
            opacity: 0.9;
            font-weight: 400;
        }

        /* Session Controls */
        .session-controls {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem 2rem;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 2rem;
            align-items: center;
        }

        .prep-track-section {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .prep-track-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .prep-track-select {
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--surface);
            font-size: 1rem;
            font-weight: 500;
            color: var(--text);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .prep-track-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .session-stats {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: block;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 500;
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            background: var(--surface-2);
        }

        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        /* Welcome Message */
        .welcome-message {
            background: var(--surface);
            border-radius: 24px;
            padding: 3rem;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .welcome-message::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .welcome-message h3 {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 1rem;
        }

        .welcome-message p {
            font-size: 1.125rem;
            line-height: 1.6;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .quick-action-btn {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.975rem;
            line-height: 1.5;
            position: relative;
            overflow: hidden;
        }

        .quick-action-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(37, 99, 235, 0.15);
        }

        .quick-action-btn .icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .quick-action-btn .title {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.25rem;
            display: block;
        }

        .quick-action-btn .description {
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        /* Messages */
        .message {
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            flex-shrink: 0;
        }

        .message.dr .message-avatar {
            background: var(--gradient-primary);
            color: white;
        }

        .message.user .message-avatar {
            background: var(--surface-3);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .message-content {
            max-width: 75%;
            background: var(--surface);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            position: relative;
        }

        .message.user .message-content {
            background: var(--gradient-primary);
            color: white;
            border: none;
        }

        .message-text {
            line-height: 1.6;
            font-size: 1rem;
        }

        .message-text strong {
            font-weight: 600;
        }

        .message-text em {
            font-style: italic;
            color: var(--accent);
        }

        .message-time {
            font-size: 0.75rem;
            opacity: 0.6;
            margin-top: 0.75rem;
            font-weight: 500;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            margin-bottom: 2rem;
            gap: 1rem;
            animation: slideIn 0.4s ease-out;
        }

        .typing-indicator.show {
            display: flex;
        }

        .typing-content {
            background: var(--surface);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .typing-text {
            color: var(--text-muted);
            font-style: italic;
            font-size: 0.975rem;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            animation: bounce 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        .typing-dot:nth-child(3) { animation-delay: 0s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1.2); opacity: 1; }
        }

        /* Input Area */
        .input-area {
            background: var(--surface);
            border-top: 1px solid var(--border);
            padding: 2rem;
        }

        .input-container {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
            max-width: 100%;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        .chat-input {
            width: 100%;
            min-height: 56px;
            max-height: 120px;
            padding: 1rem 1.5rem;
            border: 2px solid var(--border);
            border-radius: 28px;
            font-size: 1rem;
            line-height: 1.5;
            resize: none;
            background: var(--surface);
            color: var(--text);
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .send-button {
            width: 56px;
            height: 56px;
            border: none;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
            flex-shrink: 0;
        }

        .send-button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Status Indicator */
        .status-indicator {
            position: absolute;
            top: -2rem;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-muted);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .status-indicator.show {
            opacity: 1;
        }

        .status-indicator.online {
            color: var(--success);
        }

        .status-indicator.offline {
            color: var(--warning);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .app-container {
                height: 100vh;
                border-radius: 0;
            }

            .header {
                padding: 1.5rem 1rem;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .dr-avatar {
                width: 60px;
                height: 60px;
                font-size: 1.25rem;
            }

            .header-text h1 {
                font-size: 2rem;
            }

            .session-controls {
                padding: 1rem;
            }

            .controls-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .messages-container {
                padding: 1rem;
            }

            .welcome-message {
                padding: 2rem 1.5rem;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }

            .message-content {
                max-width: 85%;
                padding: 1.25rem;
            }

            .input-area {
                padding: 1rem;
            }

            .chat-input {
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="dr-avatar">DR</div>
                <div class="header-text">
                    <h1>Dr. Morgan Reynolds</h1>
                    <p class="subtitle">Elite NCLEX Mastery Specialist • 98% First-Attempt Success Rate</p>
                </div>
            </div>
        </header>

        <!-- Session Controls -->
        <div class="session-controls">
            <div class="controls-grid">
                <div class="prep-track-section">
                    <label for="prepTrack" class="prep-track-label">Your Preparation Track</label>
                    <select id="prepTrack" class="prep-track-select">
                        <option value="assessment">🔍 Initial Assessment & Strategy</option>
                        <option value="first-time">🎯 First-Time Test Taker</option>
                        <option value="repeat">🔄 Repeat Test Taker Protocol</option>
                        <option value="ngn">🧠 NGN Clinical Judgment Mastery</option>
                        <option value="accelerated">⚡ Accelerated Recovery Program</option>
                        <option value="anxiety">😰 Test Anxiety Management</option>
                        <option value="content">📚 Content Mastery Focus</option>
                        <option value="strategy">🎲 Strategic Test-Taking Skills</option>
                    </select>
                </div>
                
                <div class="session-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="messageCount">0</span>
                        <span class="stat-label">Messages</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="sessionTime">0m</span>
                        <span class="stat-label">Session</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Container -->
        <div class="chat-container">
            <div class="messages-container" id="messagesContainer">
                <!-- Welcome Message -->
                <div class="welcome-message" id="welcomeMessage">
                    <h3>👋 Welcome! I'm Dr. Reynolds</h3>
                    <p><strong>Ready to create your personalized NCLEX success strategy?</strong></p>
                    <p>I've guided thousands of nursing students to pass with my evidence-based protocols and clinical reasoning frameworks.</p>
                    <p><em>Whether you're a first-timer or need a strategic comeback, let's identify exactly what you need to succeed.</em></p>
                    
                    <div class="quick-actions">
                        <button class="quick-action-btn" onclick="quickStart('I failed NCLEX and need to figure out exactly what went wrong and how to fix it')">
                            <span class="icon">💪</span>
                            <span class="title">Failed NCLEX - Need Strategy</span>
                            <span class="description">Comprehensive failure analysis and recovery protocol</span>
                        </button>
                        <button class="quick-action-btn" onclick="quickStart('I struggle with SATA questions and always second-guess myself')">
                            <span class="icon">🎯</span>
                            <span class="title">SATA Question Mastery</span>
                            <span class="description">Systematic approach to Select All That Apply</span>
                        </button>
                        <button class="quick-action-btn" onclick="quickStart('How do I know when I am ready to take the NCLEX? What are the signs?')">
                            <span class="icon">⏰</span>
                            <span class="title">Readiness Assessment</span>
                            <span class="description">Multi-dimensional readiness evaluation</span>
                        </button>
                        <button class="quick-action-btn" onclick="quickStart('I get anxious during practice tests and my mind goes blank')">
                            <span class="icon">🧘‍♀️</span>
                            <span class="title">Test Anxiety Control</span>
                            <span class="description">Cognitive performance optimization</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typingIndicator">
                <div class="message-avatar">DR</div>
                <div class="typing-content">
                    <span class="typing-text">Dr. Reynolds is analyzing your question...</span>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-area">
                <div class="status-indicator" id="statusIndicator">
                    <span id="connectionStatus">🟢 Connected to Dr. Reynolds</span>
                </div>
                <div class="input-container">
                    <div class="input-wrapper">
                        <textarea 
                            id="chatInput" 
                            class="chat-input" 
                            placeholder="Describe your NCLEX challenge, study concerns, or specific questions..."
                            rows="1"></textarea>
                    </div>
                    <button id="sendButton" class="send-button">
                        <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Session management with your original detailed responses
        class SessionManager {
            constructor() {
                this.data = this.loadSession();
                this.initializeUI();
                this.startTimer();
            }

            loadSession() {
                try {
                    const saved = localStorage.getItem('drReynoldsSession');
                    if (saved) {
                        const data = JSON.parse(saved);
                        data.startTime = new Date(data.startTime);
                        return data;
                    }
                } catch (e) {
                    console.log('Starting fresh session');
                }

                return {
                    messageCount: 0,
                    startTime: new Date(),
                    conversationHistory: [],
                    prepTrack: 'assessment',
                    studentName: null,
                    preferences: {}
                };
            }

            saveSession() {
                try {
                    localStorage.setItem('drReynoldsSession', JSON.stringify(this.data));
                } catch (e) {
                    console.log('Session save failed, continuing in memory');
                }
            }

            updateMessageCount() {
                this.data.messageCount++;
                document.getElementById('messageCount').textContent = this.data.messageCount;
                this.saveSession();
            }

            updatePrepTrack(track) {
                this.data.prepTrack = track;
                this.saveSession();
            }

            addToHistory(role, content) {
                this.data.conversationHistory.push({
                    role,
                    content,
                    timestamp: new Date().toISOString()
                });
                this.saveSession();
            }

            getRecentHistory(limit = 6) {
                return this.data.conversationHistory
                    .slice(-limit)
                    .map(msg => ({
                        role: msg.role,
                        content: msg.content
                    }));
            }

            initializeUI() {
                document.getElementById('prepTrack').value = this.data.prepTrack;
                document.getElementById('messageCount').textContent = this.data.messageCount;
                this.updateTimer();
            }

            startTimer() {
                setInterval(() => this.updateTimer(), 30000);
            }

            updateTimer() {
                const now = new Date();
                const diffMinutes = Math.floor((now - this.data.startTime) / (1000 * 60));
                document.getElementById('sessionTime').textContent = `${diffMinutes}m`;
            }
        }

        // Your original evidence-based response system (kept intact!)
        const drReynoldsCore = {
            getPersonalizedResponse(message, context) {
                const analysis = this.analyzeMessage(message, context);
                const response = this.generateResponse(analysis, context);
                return this.addPersonalityMarkers(response, analysis);
            },

            analyzeMessage(message, context) {
                const msg = message.toLowerCase();
                const analysis = {
                    urgency: this.detectUrgency(msg),
                    category: this.categorizeMessage(msg),
                    emotionalState: this.detectEmotionalState(msg),
                    previousContext: context.conversationHistory,
                    userTrack: context.prepTrack
                };
                return analysis;
            },

            detectUrgency(msg) {
                const urgentKeywords = ['test tomorrow', 'testing soon', 'failed', 'panic', 'desperate', 'last chance'];
                return urgentKeywords.some(keyword => msg.includes(keyword)) ? 'high' : 'normal';
            },

            categorizeMessage(msg) {
                const categories = {
                    'sata': ['sata', 'select all', 'multiple', 'checkbox'],
                    'prioritization': ['priority', 'prioritize', 'first', 'delegate', 'assign'],
                    'pharmacology': ['pharm', 'drug', 'medication', 'med', 'dosage'],
                    'anxiety': ['anxious', 'nervous', 'panic', 'stress', 'worried', 'scared'],
                    'readiness': ['ready', 'when to test', 'schedule', 'timing'],
                    'ngn': ['ngn', 'clinical judgment', 'case study', 'scenario'],
                    'repeat': ['failed', 'retake', 'again', 'second time', 'third'],
                    'content': ['don\'t know', 'confused', 'understand', 'explain'],
                    'strategy': ['study plan', 'how to', 'method', 'approach']
                };

                for (const [category, keywords] of Object.entries(categories)) {
                    if (keywords.some(keyword => msg.includes(keyword))) {
                        return category;
                    }
                }
                return 'general';
            },

            detectEmotionalState(msg) {
                if (/panic|desperate|hopeless|give up/.test(msg)) return 'distressed';
                if (/confident|ready|excited/.test(msg)) return 'positive';
                if (/confused|lost|don't know/.test(msg)) return 'uncertain';
                if (/frustrated|angry|unfair/.test(msg)) return 'frustrated';
                return 'neutral';
            },

            generateResponse(analysis, context) {
                const responses = this.getResponseBank();
                let baseResponse = responses[analysis.category] || responses.general;
                
                if (context.conversationHistory.length > 0) {
                    baseResponse = this.addContinuityMarkers(baseResponse, context);
                }

                return this.customizeForTrack(baseResponse, context.prepTrack, analysis);
            },

            // Your complete evidence-based response bank (kept exactly as is!)
            getResponseBank() {
                return {
                    sata: [
                        "I can see you're struggling with SATA questions - this is actually a **cognitive processing issue**, not a content problem. 78% of my students who fail SATA questions have this exact pattern.\n\nLet me give you my **SATA Systematic Elimination Protocol**: First, read the scenario and identify the PRIMARY nursing concern. Then evaluate each option asking 'Does this address my primary concern?' Mark those first. Next, 'Is this within my scope of practice?' Finally, 'Is this the most effective intervention available?'\n\nHere's what I want you to practice today: Take 10 SATA questions, but spend 3 minutes on each instead of rushing. Use my elimination sequence on every option. Your accuracy should jump 25-30% immediately.\n\n**Key insight**: SATA questions test clinical reasoning patterns, not memorization. Once you crack the pattern, they become predictable.",
                        "SATA struggles tell me exactly what's happening in your cognitive processing. You're not evaluating options systematically - you're randomly checking boxes hoping for the best. Let's fix this with precision intervention.\n\nMy **SATA Cognitive Restructuring Method**: Start by circling the patient's primary problem. Every correct answer MUST relate to this problem. Then use my **ABC-P framework**: Airway/Breathing/Circulation first, then Pain/Psychosocial.\n\nPractice this way: Cover the options, read the scenario, predict what you think should be done, THEN look at the options. This builds pattern recognition instead of reactive guessing.\n\nI want you to do 15 SATA questions using this method. Time yourself - aim for 2 minutes per question. Your brain needs to learn the systematic approach first, speed comes later."
                    ],

                    prioritization: [
                        "Prioritization questions are **cognitive architecture tests** - they're evaluating how your nursing brain organizes information under pressure. Your struggles here tell me we need to rebuild your decision-making framework.\n\nLet me teach you my **Priority Matrix System**: Level 1 threats (airway, massive bleeding, cardiac arrest) always come first. Level 2 threats (acute pain, infection signs, abnormal vitals) come next. Level 3 items (comfort measures, discharge planning) come last.\n\nBut here's the critical insight most students miss: NCLEX prioritization isn't bedside prioritization. It's **systematic safety prioritization**. Use my **SAFETY-FIRST algorithm**: S-Stability threats, A-Acute symptoms, F-Functioning problems, E-Education needs, T-Testing requirements, Y-Yearly maintenance.\n\nPractice this on 20 priority questions today. Write down your reasoning for each choice. This builds the neural pathways for automatic correct prioritization.",
                        "I can diagnose your prioritization issue immediately - you're thinking like a bedside nurse instead of an NCLEX test-taker. These require different cognitive frameworks.\n\nMy **Priority Decision Tree**: Ask yourself three questions in order: 1) 'Is someone dying right now?' (airway, cardiac, bleeding), 2) 'Is someone about to get worse?' (pain, infection, abnormal assessment), 3) 'What supports long-term outcomes?' (education, psychosocial, prevention).\n\nThe secret sauce: **NCLEX prioritization is SAFETY prioritization**, not efficiency prioritization. In real nursing, you might check on the anxious patient first because they're nearby. In NCLEX, you assess the chest pain patient first because of physiological priority.\n\nDo 25 prioritization questions using my decision tree. Force yourself to verbalize your reasoning process. This conscious practice builds unconscious competence."
                    ],

                    pharmacology: [
                        "Pharmacology overwhelm is cognitive overload, not content deficiency. You're trying to memorize thousands of facts instead of understanding **drug action patterns**. Let me restructure your approach.\n\nMy **Strategic Pharm Protocol**: Focus on 12 drug categories that represent 80% of NCLEX pharm content: cardiac meds, antibiotics, analgesics, psych meds, diabetes meds, anticoagulants, steroids, diuretics, bronchodilators, anticonvulsants, antihypertensives, and chemotherapy.\n\nFor each category, learn the **Pattern of Four**: 1) Why we give it (indication), 2) How we know it's working (therapeutic effect), 3) What could go wrong (adverse effects), 4) What we monitor (nursing implications).\n\n**Start today**: Pick ONE category. Master the Pattern of Four for 3-5 drugs in that category. Do 10 pharm questions focusing only on that category. Build mastery before breadth.\n\nMost students see 40% improvement in pharm scores within one week using this systematic approach.",
                        "Your pharmacology struggles indicate **conceptual fragmentation** - you know facts but can't connect them to clinical scenarios. Let's fix this with my **Clinical Integration Method**.\n\nStop memorizing drug names and doses. Instead, learn **drug behaviors**: How do cardiac drugs affect heart function? How do psych meds change brain chemistry? How do antibiotics fight infections?\n\nMy **Pharm Mastery Framework**: For every drug category, understand the **physiological story**: What's broken in the body? → How does this drug fix it? → How do we know it's working? → What happens if it goes wrong?\n\nPractice application: Take 5 cardiac drugs, map their mechanisms, then do 15 cardiac pharm questions. Your brain will start recognizing patterns instead of memorizing isolated facts.\n\nThis method typically improves pharm performance by 35-50% within two weeks."
                    ],

                    anxiety: [
                        "Test anxiety isn't a character flaw - it's a **cognitive performance disruption** that responds to specific interventions. I've developed protocols that reduce anxiety symptoms by 70% in most students.\n\nYour anxiety is telling me two things: 1) You're placing too much emotional weight on individual questions, and 2) Your cognitive confidence is lower than your actual knowledge level.\n\n**My Anxiety Control Protocol**: Use **Cognitive Interruption Technique** - when you feel panic rising, stop, take 3 deep breaths, say 'I know more than I think I know,' then restart the question. Practice this during every practice session.\n\nAlso implement **Strategic Question Reframing**: Instead of 'What if I get this wrong?' ask 'What does this question teach me about nursing priorities?'\n\n**Homework**: Do 20 practice questions while intentionally practicing anxiety management. Rate your anxiety 1-10 before and after each question. This builds anxiety tolerance while maintaining performance.",
                        "I can tell you're experiencing **performance anxiety**, not knowledge anxiety. Your brain knows the content but stress hormones are interfering with recall and decision-making.\n\nLet me teach you my **Cognitive State Management System**: Before each practice session, do my **Confidence Calibration exercise**: List 3 things you know well about nursing, remind yourself of your clinical successes, then affirm 'I have the knowledge to succeed.'\n\nDuring questions, use **Strategic Breathing**: 4 counts in, 4 counts hold, 4 counts out. This optimizes oxygen to your prefrontal cortex where decision-making happens.\n\n**Critical insight**: Some anxiety actually improves performance when properly managed. We're not eliminating anxiety, we're channeling it into focused attention.\n\nPractice this during your next 30 questions. You should notice clearer thinking and faster decision-making within a few days."
                    ],

                    readiness: [
                        "Readiness assessment requires **multidimensional analysis**, not just practice test scores. Let me evaluate your true readiness using my **7-Point Readiness Protocol**.\n\n**Content Readiness**: Are you consistently scoring 75%+ across ALL content areas? Any domain below 70% needs targeted intervention.\n\n**Cognitive Readiness**: Can you complete 145 questions without cognitive fatigue? Are you making decisions within 1.5 minutes per question?\n\n**Psychological Readiness**: Do you feel confident in your nursing judgment? Are you managing test anxiety effectively?\n\n**Strategic Readiness**: Can you consistently apply test-taking strategies without second-guessing?\n\nHere's my assessment: If you're scoring 75%+ consistently, completing practice tests without fatigue, and feeling confident in your clinical reasoning, you're likely ready. If any component is weak, we need 1-2 more weeks of targeted intervention.\n\n**Next step**: Take my comprehensive readiness assessment - 150 questions covering all domains. Your performance pattern will tell us exactly where you stand.",
                        "True NCLEX readiness isn't about perfect scores - it's about **consistent competent performance** across multiple dimensions. Most students test too early because they focus only on content scores.\n\nMy **Readiness Indicators**: 1) Stable performance (scores don't fluctuate more than 10%), 2) Cognitive endurance (maintaining accuracy through 145+ questions), 3) Content coverage (no weak domains), 4) Strategic thinking (using systematic approaches), 5) Controlled anxiety (stress enhances rather than impairs performance).\n\n**The critical test**: Can you explain WHY your correct answers are correct and WHY your incorrect choices are wrong? This metacognitive awareness predicts NCLEX success better than raw scores.\n\nSchedule your exam when you can confidently say 'I understand nursing thinking patterns' rather than 'I hope I studied enough.'"
                    ],

                    ngn: [
                        "NGN success requires **clinical reasoning architecture**, not content memorization. The new format evaluates your thinking process, and traditional prep methods won't work.\n\nLet me teach you my **NGN Clinical Judgment Framework**: The six operations aren't separate skills - they're a **cognitive sequence** that mirrors real nursing thinking.\n\n**Cue Recognition**: Train your brain to identify relevant vs. irrelevant data. Practice with complex scenarios, circle only information that impacts nursing care.\n\n**Cue Analysis**: Ask 'What does this tell me about the patient's condition?' Connect assessment findings to pathophysiology.\n\n**Hypothesis Formation**: Generate 2-3 possible explanations for what you're seeing. The NCLEX wants systematic differential thinking.\n\n**Priority Setting**: Use my **Safety-Impact Matrix** - which hypothesis poses the greatest immediate threat?\n\n**Intervention Planning**: Select actions that directly address your priority hypothesis.\n\n**Evaluation**: Determine if your interventions achieved the intended outcomes.\n\n**Practice method**: Use unfolding case studies, work through each step consciously until it becomes automatic.",
                        "NGN represents the future of nursing assessment - it's evaluating **clinical judgment competency**, not factual recall. Your preparation needs to develop systematic thinking patterns.\n\nMy **NGN Mastery Protocol**: Stop practicing isolated questions. Start with **case-based reasoning scenarios** that require you to work through the complete clinical judgment process.\n\n**Key insight**: NGN questions have built-in cognitive scaffolding. Each part of the question guides you through the reasoning process. Learn to use this structure to your advantage.\n\n**Training approach**: Take one complex patient scenario. Work through it using my six-step framework. Then find 3 similar scenarios and apply the same process. This builds **pattern recognition** for clinical reasoning.\n\nMost students achieve NGN proficiency within 3-4 weeks of focused practice using systematic reasoning development rather than random question practice."
                    ],

                    repeat: [
                        "As a repeat test-taker, you need **pattern correction**, not content review. My analysis of 1000+ repeat candidates shows specific failure patterns that predict success or continued struggle.\n\n**First**: We identify exactly why you didn't pass. Was it content gaps, test-taking strategy issues, anxiety interference, or clinical reasoning problems? Most repeat takers have 2-3 specific issues, not global knowledge deficits.\n\n**My Recovery Protocol**: 1) Diagnostic assessment to pinpoint failure patterns, 2) Targeted intervention on ONLY identified weaknesses, 3) Confidence rebuilding through systematic success experiences, 4) Test psychology management to eliminate anxiety interference.\n\n**Critical insight**: Repeat takers who use the same study methods get the same results. We're implementing a **completely different approach** based on your specific failure analysis.\n\n**Timeline**: Most repeat candidates achieve readiness in 4-6 weeks using my targeted methodology, compared to 8-12 weeks with traditional approaches.\n\nTell me about your previous testing experience - I'll identify your specific intervention needs.",
                        "Repeat testing requires **strategic intervention**, not harder studying. You likely have adequate knowledge but need cognitive pattern correction and psychological reconstruction.\n\nMy **Repeat Success Framework**: \n\n**Phase 1 - Failure Analysis**: Identify the specific cognitive or emotional patterns that caused previous failure. This isn't about content you missed - it's about thinking patterns that led to wrong choices.\n\n**Phase 2 - Pattern Correction**: Implement targeted exercises to correct identified thinking errors. Most repeat failures stem from 3-4 specific mistake patterns.\n\n**Phase 3 - Confidence Reconstruction**: Rebuild testing confidence through progressive success experiences. Previous failure creates psychological barriers that interfere with performance.\n\n**Phase 4 - Performance Optimization**: Fine-tune test-taking psychology and strategic approaches for optimal performance.\n\n**Success rate**: 89% of repeat takers using my methodology pass on their next attempt, compared to 45% using traditional review methods."
                    ],

                    content: [
                        "Content confusion usually indicates **conceptual fragmentation** rather than knowledge deficits. You know facts but can't connect them into clinical reasoning patterns.\n\nMy **Content Integration Method**: Stop studying isolated facts. Start building **knowledge networks** that connect pathophysiology → assessment → interventions → outcomes.\n\n**Example**: Instead of memorizing 'give oxygen for hypoxemia,' understand the complete picture: Why does hypoxemia occur? → How do we recognize it? → What interventions address the underlying cause? → How do we know our interventions worked?\n\n**Study technique**: For each condition you're struggling with, create a **Clinical Reasoning Map**: Patient presentation → Nursing priorities → Interventions → Expected outcomes → Potential complications.\n\nThis approach builds the kind of integrated understanding NCLEX tests, rather than isolated fact recall.\n\n**Practice method**: Choose one content area you find confusing. Build reasoning maps for 5 conditions in that area. Then do 20 questions focusing on that content. You'll notice improved application immediately.",
                        "Content struggles often reflect **learning method mismatch** rather than cognitive deficits. Let me restructure your approach using evidence-based learning science.\n\n**My Content Mastery System**: \n\n**Active Retrieval**: Instead of re-reading notes, test yourself constantly. Can you explain concepts without looking? This builds robust memory networks.\n\n**Spaced Practice**: Review content in expanding intervals (1 day, 3 days, 1 week, 2 weeks). This creates durable learning.\n\n**Interleaved Practice**: Mix different topics within study sessions rather than blocking by subject. This improves discrimination and application.\n\n**Elaborative Integration**: Connect new information to existing knowledge. Ask 'How does this relate to what I already know?'\n\n**Application Focus**: For every fact you learn, practice applying it in 2-3 different scenarios.\n\nThis approach typically improves content retention by 60% and application ability by 40% compared to traditional review methods."
                    ],

                    strategy: [
                        "Effective NCLEX strategy isn't about test-taking tricks - it's about **systematic clinical reasoning** applied consistently under testing conditions.\n\nMy **Strategic Framework**: \n\n**Question Analysis**: Read the question stem first, identify what they're really asking, then look at options. Most students read everything and get overwhelmed.\n\n**Option Evaluation**: Use systematic elimination based on safety, scope of practice, and nursing priorities rather than gut feelings.\n\n**Time Management**: Spend appropriate time on each question type. Simple recall questions: 45 seconds. Complex scenarios: 2.5 minutes. SATA: 2 minutes.\n\n**Confidence Calibration**: When you're 80% sure of an answer, move on. Perfect certainty is impossible and wastes cognitive resources.\n\n**Error Recovery**: If you realize you made an error, don't let it affect subsequent questions. Each question is independent.\n\n**Practice method**: Use these strategies during every practice session until they become automatic. Strategy application under pressure requires deliberate practice.",
                        "Strategic NCLEX preparation requires **meta-cognitive development** - learning how to think about your thinking during the examination.\n\nMy **Cognitive Strategy System**: \n\n**Pre-question Protocol**: Before reading each question, take a breath and remind yourself 'I'm looking for the MOST appropriate nursing action.'\n\n**During-question Protocol**: Identify the patient's priority problem, eliminate options that don't address this problem, choose the safest remaining option.\n\n**Post-question Protocol**: Don't second-guess unless you identify a clear reasoning error. Move forward with confidence.\n\n**Anxiety Management**: If you feel overwhelmed, use my **Reset Technique**: Close your eyes for 3 seconds, take a deep breath, remind yourself of one thing you know for certain about nursing.\n\n**Strategic insight**: NCLEX rewards systematic thinking patterns, not perfect knowledge. Develop reliable reasoning processes that work under pressure."
                    ],

                    general: [
                        "Let me analyze your situation and provide targeted recommendations based on my assessment of your specific needs and preparation goals.",
                        "Based on what you're describing, I can identify several intervention opportunities that align with my proven methodology for NCLEX success.",
                        "This represents an excellent opportunity to apply my diagnostic framework and develop a strategic approach tailored to your unique situation."
                    ]
                };
            },

            addPersonalityMarkers(response, analysis) {
                const personalityElements = {
                    authority: [
                        "Based on my analysis of 10,000+ similar cases,",
                        "My research demonstrates that",
                        "I've developed specific protocols for this exact pattern:",
                        "This aligns with my proprietary methodology:",
                        "My data shows that students with this pattern typically"
                    ],
                    psychology: [
                        "Your brain is processing this as",
                        "This indicates a specific cognitive pattern where",
                        "The psychological component here involves",
                        "From a cognitive science perspective,",
                        "Your confidence will improve once we address"
                    ],
                    motivation: [
                        "You're closer to success than you realize.",
                        "This is completely correctable with targeted intervention.",
                        "I've seen this exact pattern resolve in 2-3 weeks.",
                        "Your success probability just increased significantly.",
                        "Once we fix this pattern, everything else becomes easier."
                    ]
                };

                if (analysis.emotionalState === 'distressed') {
                    response = this.addSupport(response);
                } else if (analysis.emotionalState === 'positive') {
                    response = this.addChallenge(response);
                }

                return response;
            },

            addSupport(response) {
                const supportElements = [
                    "I understand this feels overwhelming right now, but",
                    "Take a breath - this is completely manageable.",
                    "You're not alone in this struggle.",
                    "I've helped thousands of students through exactly this situation."
                ];
                const support = supportElements[Math.floor(Math.random() * supportElements.length)];
                return `${support} ${response}`;
            },

            addChallenge(response) {
                const challengeElements = [
                    "I can see you're building confidence, and now we can push further.",
                    "Your positive attitude tells me you're ready for advanced strategies.",
                    "This momentum is exactly what I like to see - let's leverage it."
                ];
                const challenge = challengeElements[Math.floor(Math.random() * challengeElements.length)];
                return `${challenge} ${response}`;
            },

            addContinuityMarkers(response, context) {
                if (context.conversationHistory.length > 0) {
                    const continuityPhrases = [
                        "Building on what we discussed earlier,",
                        "Following up on your previous question,",
                        "Now that we've identified your pattern,",
                        "Based on our conversation so far,"
                    ];
                    const phrase = continuityPhrases[Math.floor(Math.random() * continuityPhrases.length)];
                    return `${phrase} ${response}`;
                }
                return response;
            },

            customizeForTrack(response, track, analysis) {
                const trackCustomizations = {
                    'repeat': '\n\n**Repeat Taker Focus**: Remember, you have nursing knowledge - we\'re correcting specific thinking patterns that caused previous results.',
                    'first-time': '\n\n**First-Timer Advantage**: Your fresh perspective allows us to build optimal cognitive patterns from the start.',
                    'ngn': '\n\n**NGN Strategy**: This directly applies to clinical judgment scenarios you\'ll see on the exam.',
                    'accelerated': '\n\n**Accelerated Protocol**: We\'re implementing intensive, high-yield interventions for rapid improvement.',
                    'anxiety': '\n\n**Anxiety Management**: All recommendations include built-in confidence building and stress reduction components.'
                };

                return response + (trackCustomizations[track] || '');
            }
        };

        // Enhanced chat system with live AI + fallback integration
        class DrReynoldsChat {
            constructor() {
                this.session = new SessionManager();
                this.isConnected = true;
                this.isTyping = false;
                this.initialize();
            }

            initialize() {
                this.setupEventListeners();
                this.updateConnectionStatus();
                this.focusInput();
            }

            setupEventListeners() {
                const chatInput = document.getElementById('chatInput');
                const sendButton = document.getElementById('sendButton');
                const prepTrack = document.getElementById('prepTrack');

                chatInput.addEventListener('input', () => {
                    chatInput.style.height = 'auto';
                    chatInput.style.height = Math.min(chatInput.scrollHeight, 120) + 'px';
                });

                chatInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                sendButton.addEventListener('click', () => this.sendMessage());

                prepTrack.addEventListener('change', (e) => {
                    this.session.updatePrepTrack(e.target.value);
                });

                if ('vibrate' in navigator) {
                    sendButton.addEventListener('click', () => {
                        navigator.vibrate(25);
                    });
                }
            }

            async sendMessage() {
                const chatInput = document.getElementById('chatInput');
                const message = chatInput.value.trim();
                
                if (!message || this.isTyping) return;

                this.removeWelcomeMessage();
                this.addMessage(message, 'user');
                this.session.addToHistory('user', message);
                this.session.updateMessageCount();

                chatInput.value = '';
                chatInput.style.height = 'auto';
                this.setInputState(false);
                this.showTypingIndicator();

                try {
                    // Try live AI first
                    const response = await this.callLiveAI(message);
                    this.hideTypingIndicator();
                    this.addMessage(response, 'dr');
                    this.session.addToHistory('assistant', response);
                    this.updateConnectionStatus(true);
                } catch (error) {
                    console.error('Live AI failed, using evidence-based fallback:', error);
                    this.hideTypingIndicator();
                    
                    // Use your detailed evidence-based responses as fallback
                    const fallbackResponse = this.getEvidenceBasedFallback(message);
                    this.addMessage(fallbackResponse, 'dr');
                    this.session.addToHistory('assistant', fallbackResponse);
                    this.updateConnectionStatus(false);
                }

                this.setInputState(true);
                this.focusInput();
            }

            async callLiveAI(message) {
                const response = await fetch('/.netlify/functions/reynolds-chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        prepTrack: this.session.data.prepTrack,
                        messageCount: this.session.data.messageCount,
                        sessionHistory: this.session.getRecentHistory(),
                        studentName: this.session.data.studentName
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.success === false || data.isError) {
                    throw new Error(data.reply || 'API returned error');
                }

                return data.reply;
            }

            getEvidenceBasedFallback(message) {
                // Use your original detailed response system when AI fails
                const fallbackResponse = drReynoldsCore.getPersonalizedResponse(message, this.session.data);
                
                return `*[Dr. Reynolds - Evidence-Based Protocol Mode]*\n\n${fallbackResponse}\n\n*I'm temporarily using my core evidence-based protocols while reconnecting to advanced AI systems. The guidance above represents proven methodologies from my 20+ years of NCLEX coaching.*`;
            }

            addMessage(content, sender) {
                const messagesContainer = document.getElementById('messagesContainer');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                
                const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const avatar = sender === 'dr' ? 'DR' : 'You';
                
                messageDiv.innerHTML = `
                    <div class="message-avatar">${avatar}</div>
                    <div class="message-content">
                        <div class="message-text">${this.formatMessage(content)}</div>
                        <div class="message-time">${time}</div>
                    </div>
                `;
                
                messagesContainer.appendChild(messageDiv);
                this.scrollToBottom();
                
                setTimeout(() => {
                    messageDiv.style.opacity = '1';
                    messageDiv.style.transform = 'translateY(0)';
                }, 100);
            }

            formatMessage(content) {
                return content
                    .replace(/\n\n/g, '</p><p>')
                    .replace(/\n/g, '<br>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/#{1,3}\s*(.*?)$/gm, '<h4>$1</h4>')
                    .replace(/^<p>/, '')
                    .replace(/<\/p>$/, '');
            }

            showTypingIndicator() {
                this.isTyping = true;
                const indicator = document.getElementById('typingIndicator');
                indicator.classList.add('show');
                this.scrollToBottom();
            }

            hideTypingIndicator() {
                this.isTyping = false;
                const indicator = document.getElementById('typingIndicator');
                indicator.classList.remove('show');
            }

            removeWelcomeMessage() {
                const welcome = document.getElementById('welcomeMessage');
                if (welcome) {
                    welcome.style.transform = 'translateY(-20px)';
                    welcome.style.opacity = '0';
                    setTimeout(() => welcome.remove(), 300);
                }
            }

            setInputState(enabled) {
                const chatInput = document.getElementById('chatInput');
                const sendButton = document.getElementById('sendButton');
                
                chatInput.disabled = !enabled;
                sendButton.disabled = !enabled;
                
                if (enabled) {
                    chatInput.placeholder = "Describe your NCLEX challenge, study concerns, or specific questions...";
                } else {
                    chatInput.placeholder = "Dr. Reynolds is preparing her response...";
                }
            }

            updateConnectionStatus(connected = true) {
                this.isConnected = connected;
                const statusIndicator = document.getElementById('statusIndicator');
                const connectionStatus = document.getElementById('connectionStatus');
                
                if (connected) {
                    connectionStatus.innerHTML = '🟢 Connected to Dr. Reynolds AI';
                    statusIndicator.className = 'status-indicator online';
                } else {
                    connectionStatus.innerHTML = '🟡 Evidence-Based Protocol Mode';
                    statusIndicator.className = 'status-indicator offline';
                }
                
                statusIndicator.classList.add('show');
                setTimeout(() => {
                    statusIndicator.classList.remove('show');
                }, 3000);
            }

            focusInput() {
                setTimeout(() => {
                    document.getElementById('chatInput').focus();
                }, 100);
            }

            scrollToBottom() {
                const container = document.getElementById('messagesContainer');
                container.scrollTop = container.scrollHeight;
            }
        }

        // Quick start functionality
        function quickStart(message) {
            const chatInput = document.getElementById('chatInput');
            chatInput.value = message;
            chat.sendMessage();
        }

        // Initialize chat system
        let chat;
        document.addEventListener('DOMContentLoaded', () => {
            chat = new DrReynoldsChat();
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
                    chat.sendMessage();
                }
            });
        });
    </script>
</body>
</html>
